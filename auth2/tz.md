
### **Техническое Задание (ТЗ)**
**Проект:** Микросервис Auth (Версия 1.0)
**Для кого:** Для разработчика (Junior)
**Задача:** Реализовать базовую аутентификацию

### **1. Суть задачи (Простыми словами)**

Сделать отдельный сервис, который:
1.  **Регистрирует** новых пользователей по почте и паролю.
2.  **Позволяет им войти** (логин), проверяя почту и пароль.
3.  **Выдает "билет" (JWT-токен)** после успешного входа.
4.  **Проверяет этот "билет"** и показывает пользователю его данные.

---

### **2. Что нужно сделать конкретно? (По пунктам)**

#### **2.1. Эндпоинт: Регистрация**
*   **URL:** `POST /auth/signup`
*   **Что приходит (тело запроса):**
    ```json
    {
      "email": "user@mail.ru",
      "password": "Qwerty123!"
    }
    ```
*   **Что нужно сделать:**
    1.  Проверить, что почта имеет правильный формат.
    2.  Проверить, что пароль достаточно сложный (минимум 8 символов, есть буквы и цифры).
    3.  Проверить, что пользователя с такой почтой еще нет в базе.
    4.  **Зашифровать пароль** (с помощью `bcrypt`).
    5.  Сохранить почту и *зашифрованный* пароль в базу данных.
*   **Что ответить:**
    *   **Если всё ок:** Статус `201 Created` и данные пользователя (БЕЗ пароля!).
    *   **Если ошибка:** Четкая ошибка (например, `409 Conflict` если почта уже занята).

#### **2.2. Эндпоинт: Логин**
*   **URL:** `POST /auth/login`
*   **Что приходит:**
    ```json
    {
      "email": "user@mail.ru",
      "password": "Qwerty123!"
    }
    ```
*   **Что нужно сделать:**
    1.  Найти пользователя в базе по почте.
    2.  Если не нашли — сразу ошибка.
    3.  Если нашли — расшифровать пароль из базы и сравнить с тем, что прислали.
    4.  Если пароли сошлись — **сгенерировать JWT-токен**.
*   **Что ответить:**
    *   **Успех:** Статус `200 OK` и JWT-токен.
        ```json
        {
          "access_token": "eyJhbGciOi...очень_длинная_строка",
          "token_type": "bearer"
        }
        ```
    *   **Ошибка:** Статус `401 Unauthorized`.

#### **2.3. Эндпоинт: Получить свои данные**
*   **URL:** `GET /users/me`
*   **Что нужно от пользователя:** Он должен прислать свой токен в заголовке:
    `Authorization: Bearer сюда_вставляем_токен`
*   **Что нужно сделать:**
    1.  Взять токен из заголовка.
    2.  **Проверить, что он подлинный** и не просроченный.
    3.  Достать из него ID пользователя.
    4.  Найти этого пользователя в базе и вернуть его данные.
*   **Что ответить:**
    *   Данные пользователя (почта, id) или ошибка `401`, если токен невалидный.

---

### **3. Как это проверить? (Критерии готовности)**

Задача считается выполненной, если **все пункты ниже работают**:

1.  **Регистрация:**
    *   ✅ Отправляю `POST /auth/signup` — получаю `201` и данные пользователя.
    *   ✅ Отправляю тот же запрос еще раз — получаю ошибку `409`.
    *   ✅ Отправляю запрос с плохим email (`not-an-email`) — получаю ошибку `422`.

2.  **Логин:**
    *   ✅ Отправляю `POST /auth/login` с правильными данными — получаю `200` и токен.
    *   ✅ Отправляю с неправильным паролем — получаю `401`.
    *   ✅ Отправляю с несуществующей почтой — получаю `401`.

3.  **Проверка токена:**
    *   ✅ Копирую токен из успешного логина.
    *   ✅ Отправляю `GET /users/me` с заголовком `Authorization: Bearer <токен>` — получаю `200` и свои данные.
    *   ✅ Меняю одну букву в токене и отправляю запрос — получаю `401`.
    *   ✅ Отправляю запрос без заголовка `Authorization` — получаю `401`.

4.  **Безопасность:**
    *   ✅ В базе данных пароль пользователя **зашифрован** (идет не в чистом виде).
    *   ✅ В ответах сервера **никогда не возвращается пароль** (ни в чистом, ни в зашифрованном виде).

---

### **4. Технологии и подсказки**

*   **Фреймворк:** FastAPI (он сам многое делает за тебя, например, проверяет данные).
*   **База данных:** PostgreSQL.
*   **Для паролей:** Библиотека `passlib[bcrypt]`.
*   **Для токенов:** Библиотека `python-jose`.
*   **Для работы с БД:** SQLAlchemy + Alembic (для миграций).
*   **Секретный ключ для JWT:** Должен быть длинным и случайным. Храни его в переменных окружения (файл `.env`)!

**Важно:** Не изобретай велосипед. Используй готовые, проверенные библиотеки для шифрования и токенов. Твоя задача — правильно их склеить между собой.

---

### **5. Что НЕ нужно делать (на сейчас)**

*   ❌ Восстановление пароля.
*   ❌ Refresh-токены.
*   ❌ Подтверждение почты.
*   ❌ Вход через Google/GitHub.
*   ❌ Роли и права доступа (админ, пользователь).

Всё это — задачи для версий 2.0 и 3.0. Сначала сделай надежное ядро.

---

Это исчерпывающая инструкция. Твоя задача — взять этот документ и **последовательно реализовать каждый пункт**.

Начни с модели пользователя в БД, потом сделай регистрацию, потом логин, потом проверку токена. После каждого шага проверяй себя по **Критериям готовности**.

У тебя всё получится! Это классическая задача, которую решают все разработчики.